name: Build and publish npm package

on:
  push:
    branches:
      - master
      - feature/create_fastapi_server

jobs:
  generate-npm-package:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 16

      - name: Generate npm package
        run: |
          npx @openapitools/openapi-generator-cli generate -i "openapi.json" \
          -g typescript-axios --additional-properties=npmName=@noadudai/noaservice \
          --additional-properties=npmVersion=${{github.sha}} \
          --additional-properties=useSingleRequestParameter=true -o ./api-npm
          cd api-npm/
          npm install 
          npm run build
          npm install . --save
          npm link

  triger-front-workflow:
    runs-on: ubuntu-latest
    needs: generate-npm-package
    steps:
      - name: Trigger the Front-end workflow
        uses: benc-uk/workflow-dispatch@v1
        with:
          repo: noadudai/KeepOnTimeShifts
          ref: feature/github_workflow
          workflow: link-package.yml

